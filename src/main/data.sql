select * from user_Tables;
CREATE TABLE employer (
                          id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                          name VARCHAR2(255) NOT NULL,
                          company_name VARCHAR2(255) NOT NULL,
                          email VARCHAR2(100) NOT NULL UNIQUE,
                          password VARCHAR2(255) NOT NULL
);

INSERT INTO employer (id, name, company_name, email, password)
VALUES (1, 'John Doe', 'TechCorp', 'johndoe@techcorp.com', 'employerpassword');

INSERT INTO employer (id, name, company_name, email, password)
VALUES (2, 'Costel Cost ', 'Microsoft', 'costelxx@techcorp.com', 'employerpass');

INSERT INTO employer (id, name, company_name, email, password)
VALUES (11, 'Vasile Vas ', 'Log', 'vasilevas@log.com', 'employerpass');

CREATE TABLE users (
                      id INT PRIMARY KEY,             -- User ID as primary key
                      email VARCHAR(255) NOT NULL      -- Email as a shared field across all user types
);


INSERT INTO users (id, email)
VALUES (1, 'johndoe@techcorp.com');

INSERT INTO users (id, email)
VALUES (21, 'student1@microsoft.com');

INSERT INTO users (id, email)
VALUES (11, 'vasilevas@log.com');

INSERT INTO users (id, email)
VALUES (2, 'student1@microsoft.com');

INSERT INTO users (id, email)
VALUES (3, 'johnado@microsoft.com');

INSERT INTO users (id, email)
VALUES (4, 'costelxx@techcorp.com');

select * from users;
select * from employer;

SELECT * FROM employer WHERE email = 'johnado@microsoft.com';


DELETE FROM users WHERE id = 2;
DELETE FROM profile WHERE user_id = 2;
DELETE from USERS where email = 'student1@microsoft.com';

DELETE FROM employer WHERE id = 2;

INSERT INTO profile (user_id, bio,  contact_info, first_name, last_name)
VALUES (1,'Employer at TechCorp','johndoe@techcorp.com','John', 'Doe');


INSERT INTO profile (user_id, bio,  contact_info, first_name, last_name)
VALUES (2,'Student','student1@microsoft.com','Marius', 'Marian');


INSERT INTO profile (user_id, bio,  contact_info, first_name, last_name)
VALUES (11,'Employer at Log','vasilevas@log.com','Vasile', 'Vas');

INSERT INTO profile (user_id, bio,  contact_info, first_name, last_name)
VALUES (4,'Employer at TechCorp','costelxx@techcorp.com','Costel', 'Cost');

INSERT INTO profile (user_id, bio,  contact_info, first_name, last_name)
VALUES (21,'Student','student1@microsoft.com','Costel', 'Cost');


select * from profile;
INSERT INTO student (id,email, password)
VALUES (21, 'student1@microsoft.com', 'student1');

select * from student;

SELECT * FROM student WHERE email = 'student1@microsoft.com';

drop table cv;

select * from cv;

ALTER TABLE CV
ADD user_id NUMBER;

ALTER TABLE CV
    ADD CONSTRAINT fk_user_id
        FOREIGN KEY (user_id)
            REFERENCES profile(user_id);

CREATE SEQUENCE cv_id_seq START WITH 1 INCREMENT BY 1;
ALTER TABLE CV ADD (NEW_ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY);
ALTER TABLE CV MODIFY (ID NUMBER DEFAULT cv_id_seq.nextval);

ALTER TABLE CV DROP COLUMN ID;

SELECT sequence_name
FROM all_sequences
WHERE sequence_name = 'CV_ID_SEQ';

DROP SEQUENCE cv_id_seq;

SELECT constraint_name, table_name
FROM user_constraints
WHERE r_constraint_name IN (SELECT constraint_name FROM user_constraints WHERE table_name = 'CV');

ALTER TABLE PROFILE DROP CONSTRAINT FKEK4FK4J528TNQ0IU9KUADC7LH;

ALTER TABLE CV RENAME COLUMN NEW_ID TO ID;

ALTER TABLE CV DROP COLUMN id;

ALTER  TABLE PROFILE DROP COLUMN CV_ID;

ALTER TABLE CV ADD id NUMBER GENERATED ALWAYS AS IDENTITY (START WITH 1);

SELECT * FROM CV WHERE user_id = 21;


ALTER TABLE CV DROP COLUMN ACHIEVEMENTS;

commit;

ALTER TABLE "CV" ADD "SUMMARY" VARCHAR2(255);

ALTER TABLE "CV" ADD "TECHNOLOGIES" VARCHAR2(255);

ALTER TABLE "CV" ADD "CERTIFICATIONS" VARCHAR2(255);

ALTER TABLE "CV" ADD "TOOLS" VARCHAR2(255);


ALTER TABLE "CV" ADD "CAMPAIGNEXP" VARCHAR2(255);

ALTER TABLE "CV" ADD "TARGETAUDIENCE" VARCHAR2(255);

ALTER TABLE "CV" ADD "PORTFOLIO" VARCHAR2(255);

ALTER TABLE "CV" ADD "CLINICALEXPERIENCE" VARCHAR2(255);

ALTER TABLE "CV" ADD "DEGREE" VARCHAR2(255);

ALTER TABLE "CV" ADD "AWARDS" VARCHAR2(255);

ALTER TABLE "CV" ADD "CVTYPE" VARCHAR2(255);


ALTER TABLE CV DROP COLUMN CVTYPE;


ALTER TABLE CV DROP COLUMN IMAGE_PATH;

ALTER TABLE "CV" ADD "IMAGE_PATH"  CLOB;

select * from CV;

SELECT * FROM CV WHERE id = 39;
ALTER TABLE CV ADD CONSTRAINT pk_cv PRIMARY KEY (id);

ALTER TABLE PROFILE ADD cv_id NUMBER;
ALTER TABLE PROFILE ADD CONSTRAINT fk_profi_cv FOREIGN KEY (cv_id) REFERENCES CV(id);

SELECT * FROM user_tab_columns WHERE table_name = 'USER';

SELECT email FROM users;

select * from employer;

ALTER TABLE employer DROP COLUMN NAME;

ALTER TABLE employer DROP COLUMN COMPANY_NAME;

ALTER TABLE employer DROP COLUMN PASSWORD;

ALTER TABLE STUDENT DROP COLUMN PASSWORD;

ALTER TABLE users
    ADD CONSTRAINT email_unique UNIQUE (email);

SELECT constraint_name
FROM user_constraints
WHERE table_name = 'USERS';

DELETE FROM users
WHERE rowid NOT IN (
    SELECT MIN(rowid)
    FROM users
    GROUP BY email
);

DELETE FROM student WHERE email IN (SELECT email FROM users WHERE email = 'student1@microsoft.com');
DELETE FROM student WHERE id IN (SELECT id FROM users WHERE id = 19);
DELETE FROM employer WHERE email IN (SELECT email FROM users WHERE email = 'costelxx@techcorp.com');
DELETE FROM users WHERE email = 'student1@microsoft.com';
DELETE FROM users WHERE email IN (SELECT email FROM users WHERE email = 'student1@microsoft.com');

DELETE FROM profile WHERE user_id = 21;

DELETE FROM users WHERE email IN (SELECT email FROM users WHERE email = 'student1@microsoft.com');

SELECT constraint_name, table_name
FROM user_constraints
WHERE r_constraint_name IN (
    SELECT constraint_name FROM user_constraints WHERE table_name = 'USERS'
);

SELECT table_name, constraint_name
FROM user_cons_columns
WHERE table_name != 'USERS'
  AND column_name = 'EMAIL';



ALTER TABLE student DROP CONSTRAINT FK3W7XMT19I6A0CR7KP8C80EK40;
ALTER TABLE employer DROP CONSTRAINT FK8BBWI5DN2PGDUBXFICFAGGUG;

ALTER TABLE profile DROP CONSTRAINT FKS14JVSF9TQRCNLY0AFSV0NGWV;

ALTER TABLE employer DROP CONSTRAINT SYS_C008454;
ALTER TABLE employer DROP CONSTRAINT SYS_C008457;

SELECT table_name, constraint_name
FROM user_constraints
WHERE r_constraint_name IN (
    SELECT constraint_name
    FROM user_constraints
    WHERE table_name = 'USERS'
);

SELECT email, COUNT(*)
FROM users
GROUP BY email
HAVING COUNT(*) > 1;

ALTER TABLE users
    ADD CONSTRAINT email_unique UNIQUE (email);


SELECT constraint_name, table_name
FROM user_constraints
WHERE table_name = 'USERS' AND constraint_type = 'U';

SELECT email FROM users;

ALTER TABLE student
    ADD CONSTRAINT student_email_unique UNIQUE (email);


SELECT constraint_name, table_name
FROM user_constraints
WHERE table_name IN ('EMPLOYER', 'STUDENT')
  AND constraint_type = 'R';

ALTER TABLE employer
    ADD CONSTRAINT fk_employer_user
        FOREIGN KEY (id)  -- Columna din employer care face referință la users
            REFERENCES users(id)   -- Columna id din users
                ON DELETE CASCADE;  -- Opțional, șterge employer-ul dacă utilizatorul din users este șters


ALTER TABLE student
    ADD CONSTRAINT fk_student_user
        FOREIGN KEY (id)  -- Columna din student care face referință la users
            REFERENCES users(id)   -- Columna id din users
                ON DELETE CASCADE;  -- Opțional, șterge studentul dacă utilizatorul din users este șters

SELECT *
FROM profile
WHERE user_id NOT IN (SELECT id FROM users);


SELECT *
FROM profile
WHERE user_id NOT IN (SELECT id FROM users);

DELETE FROM profile
WHERE user_id NOT IN (SELECT id FROM users);

DELETE FROM profile
WHERE user_id IN (SELECT user_id FROM profile WHERE CONTACT_INFO = 'student1@microsoft.com');


DELETE FROM users
WHERE id IN (SELECT user_id FROM profile WHERE user_id NOT IN (SELECT id FROM users));

DELETE FROM profile
WHERE user_id NOT IN (SELECT id FROM users);

SELECT constraint_name
FROM all_cons_columns
WHERE table_name = 'PROFILE'
  AND column_name = 'USER_ID';

ALTER TABLE profile
DROP CONSTRAINT SYS_C008468;

ALTER TABLE profile
    DROP CONSTRAINT SYS_C008469;

SELECT constraint_name, table_name
FROM all_cons_columns
WHERE table_name = 'PROFILE';

ALTER TABLE PROFILE DROP CONSTRAINT SYS_C008469;

ALTER TABLE PROFILE DROP CONSTRAINT UKJLPSM4I7ITJ569QKFRUI0GAXP;

SELECT constraint_name, table_name
FROM all_cons_columns
WHERE table_name = 'users';

SELECT * FROM CV WHERE user_id IN (SELECT user_id FROM profile);


ALTER TABLE profile DROP CONSTRAINT SYS_C008469;

SELECT table_name, constraint_name
FROM all_cons_columns
WHERE table_name = 'PROFILE';

SELECT *
FROM CV
WHERE user_id IN (SELECT user_id FROM profile);

DELETE FROM CV
WHERE user_id IN (SELECT user_id FROM profile WHERE contact_info = 'student1@microsoft.com');

SELECT a.table_name, a.constraint_name, c.owner,
       -- You can add more columns if needed to inspect foreign key relationships
       c.table_name, c.constraint_name
FROM all_cons_columns a
         JOIN all_constraints c
              ON a.constraint_name = c.constraint_name
WHERE c.constraint_type = 'R'
  AND a.table_name = 'PROFILE';




DELETE FROM profile WHERE contact_info = 'student1@microsoft.com';

ALTER TABLE profile
    ADD CONSTRAINT fk_user_id FOREIGN KEY (user_id)
        REFERENCES users(id);

CREATE SEQUENCE user_seq START WITH 1 INCREMENT BY 1;

DELETE FROM profile WHERE user_id = 21;
DELETE FROM cv WHERE user_id = 21;

ALTER TABLE EMPLOYER DROP COLUMN EMAIL;

ALTER TABLE "EMPLOYER" ADD "COMPANYNAME" VARCHAR2(255);
ALTER TABLE "EMPLOYER" ADD "COMPANYEMAIL" VARCHAR2(255);
ALTER TABLE "EMPLOYER" ADD "COMPANYPHONE" VARCHAR2(255);
ALTER TABLE "EMPLOYER" ADD "LASTNAME" VARCHAR2(255);
ALTER TABLE "EMPLOYER" ADD "FIRSTNAME" VARCHAR2(255);

ALTER TABLE STUDENT DROP COLUMN UNIVERSITYNAME;
ALTER TABLE STUDENT DROP COLUMN UNIVERSITYEMAIL;
ALTER TABLE STUDENT DROP COLUMN FIRSTNAME;
ALTER TABLE STUDENT DROP COLUMN LASTNAME;

ALTER TABLE "STUDENT" ADD "UNIVERSITYNAME" VARCHAR2(255);
ALTER TABLE "STUDENT" ADD "UNIVERSITYEMAIL" VARCHAR2(255);
ALTER TABLE "STUDENT" ADD "PHONE" VARCHAR2(255);
ALTER TABLE "STUDENT" ADD "LASTNAME" VARCHAR2(255);
ALTER TABLE "STUDENT" ADD "FIRSTNAME" VARCHAR2(255);

ALTER TABLE "EMPLOYER" DROP COLUMN "COMPANYNAME" ;
ALTER TABLE "EMPLOYER" DROP COLUMN "COMPANYEMAIL";
ALTER TABLE "EMPLOYER" DROP COLUMN "COMPANYPHONE";
ALTER TABLE "EMPLOYER" DROP COLUMN "LASTNAME";
ALTER TABLE "EMPLOYER" DROP COLUMN "FIRSTNAME";

select * from STUDENT;

ALTER TABLE users ADD version INT DEFAULT 0;

ALTER TABLE "EMPLOYER" ADD "BIO" VARCHAR2(255);
ALTER TABLE "STUDENT" ADD "BIO" VARCHAR2(255);

SELECT * FROM users WHERE id = 33;


ALTER TABLE cv
    ADD CONSTRAINT fk_user_id
        FOREIGN KEY (USER_ID) REFERENCES users(ID);

SELECT constraint_name, constraint_type
FROM user_constraints
WHERE table_name = 'CV';

ALTER TABLE cv
    DROP CONSTRAINT FK_USER_ID;


CREATE SEQUENCE user_id_seq START WITH 1 INCREMENT BY 1;
ALTER TABLE users MODIFY id NUMBER DEFAULT user_id_seq.NEXTVAL;

SELECT MAX(id) FROM users;
ALTER SEQUENCE user_id_seq RESTART START WITH 1;

DELETE FROM users
WHERE id = 1;


SELECT constraint_name, column_name
FROM user_cons_columns
WHERE table_name = 'USERS'
  AND constraint_name = 'SYS_C0030368';

ALTER TABLE users MODIFY id NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY;

DELETE FROM EMPLOYER where id = 1;

DELETE FROM STUDENT where id = 2;

DELETE FROM USERS where id = 2;

DELETE FROM PROFILE where user_id = 2;

delete from profile;

SELECT * FROM all_cons_columns WHERE table_name = 'PROFILE' AND constraint_name = 'FK_USER_ID';

SELECT constraint_name, table_name, r_constraint_name
FROM all_constraints
WHERE table_name = 'PROFILE' AND constraint_type = 'R';

SELECT * FROM all_cons_columns WHERE constraint_name = 'FKS14JVSF9TQRCNLY0AFSV0NGWV';
ALTER TABLE PROFILE DROP CONSTRAINT SYS_C0030364;

SELECT constraint_name, table_name, r_constraint_name
FROM all_constraints
WHERE constraint_name = 'FK_USER_ID';


SELECT constraint_name, table_name
FROM all_cons_columns
WHERE FK_USER_ID = 'SYS_C0030364';

ALTER TABLE PROFILE DROP CONSTRAINT SYS_C0030363;
ALTER TABLE PROFILE DROP CONSTRAINT SYS_C0030364;

ALTER TABLE CV DROP CONSTRAINT SYS_C0031049;


ALTER TABLE CV DROP CONSTRAINT PK_CV;

ALTER TABLE cv ADD is_uploaded NUMBER(1) DEFAULT 0;




commit;